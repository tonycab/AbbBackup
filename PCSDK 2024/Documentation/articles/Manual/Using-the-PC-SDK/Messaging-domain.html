<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Messaging domain </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Messaging domain ">
    <meta name="generator" content="docfx 2.59.2.0">
    
    <link rel="shortcut icon" href="../../../favicon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc">
    <meta property="docfx:tocrel" content="../toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../images/ABBLogo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../../articles/Introduction/GettingStarted.html" title="Introduction">Introduction</a>
                      </li>
                      <li>
                          <a href="../../../articles/Manual/Manual-Topic.html" title="Manual">Manual</a>
                      </li>
                      <li>
                          <a href="../../../articles/Samples/Samples-Topic.html" title="Samples">Samples</a>
                      </li>
                      <li>
                          <a href="../../../api/index.html" title="API Reference">API Reference</a>
                      </li>
                      <li>
                          <a href="../../../articles/releases/pc-sdk-2024-4.html" title="Releases">Releases</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">
                  
                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../Introduction/Introduction-Topic.html" title="Introduction" class="">Introduction</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Introduction/About-creating-controller-applications.html" title="About creating controller applications" class="">About creating controller applications</a>
                          </li>
                          <li class="">
                            <a href="../Introduction/Documentation-and-help.html" title="Documentation and help" class="">Documentation and help</a>
                          </li>
                          <li class="">
                            <a href="../Introduction/Terminology.html" title="Terminology" class="">Terminology</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../Installation-and-development-environment/Installation-and-development-environment-Topic.html" title="Installation and development environment" class="">Installation and development environment</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Installation-and-development-environment/Installation-overview.html" title="Installation overview" class="">Installation overview</a>
                          </li>
                          <li class="">
                            <a href="../Installation-and-development-environment/How-to-set-up-your-PC-to-communicate-with-robot.html" title="How to set up your PC to communicate with robot" class="">How to set up your PC to communicate with robot</a>
                          </li>
                          <li class="">
                            <a href="../Installation-and-development-environment/Development-overview.html" title="Development environment" class="">Development environment</a>
                          </li>
                          <li class="">
                            <a href="../Installation-and-development-environment/Two-development-models---virtual-and-real.html" title="Two development models - virtual and real" class="">Two development models - virtual and real</a>
                          </li>
                          <li class="">
                            <a href="../Installation-and-development-environment/Installation-Directory.html" title="Installation Directory" class="">Installation Directory</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../Run-time-environment/Run-time-environment-Topic.html" title="Run-time environment" class="">Run-time environment</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Run-time-environment/Overview.html" title="Overview" class="">Overview</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../Run-time-environment/Running-PC-SDK-Applications/Running-PC-SDK-Applications-Topic.html" title="Running PC SDK Applications" class="">Running PC SDK Applications</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../Run-time-environment/Running-PC-SDK-Applications/Running-PC-SDK-Applications-Overview.html" title="Overview" class="">Overview</a>
                                </li>
                                <li class="">
                                  <a href="../Run-time-environment/Running-PC-SDK-Applications/Mastership.html" title="Mastership" class="">Mastership</a>
                                </li>
                                <li class="">
                                  <a href="../Run-time-environment/Running-PC-SDK-Applications/PC-application-configuration.html" title="PC application configuration" class="">PC application configuration</a>
                                </li>
                                <li class="">
                                  <a href="../Run-time-environment/Running-PC-SDK-Applications/Communication-between-PC-and-Controller.html" title="Communication between PC and Controller" class="">Communication between PC and Controller</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <a href="../Run-time-environment/Release-upgrades-and-compatibility.html" title="Release upgrades and compatibility" class="">Release upgrades and compatibility</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../Developing-Controller-applications/Developing-Controller-applications-Topic.html" title="Developing Controller applications" class="">Developing Controller applications</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Developing-Controller-applications/Developing-Controller-applications-introduction.html" title="Introduction" class="">Introduction</a>
                          </li>
                          <li class="">
                            <a href="../Developing-Controller-applications/Analysis-and-design.html" title="Analysis and design" class="">Analysis and design</a>
                          </li>
                          <li class="">
                            <a href="../Developing-Controller-applications/Controller-events-and-threads.html" title="Controller events and threads" class="">Controller events and threads</a>
                          </li>
                          <li class="">
                            <a href="../Developing-Controller-applications/User-Authorization-system.html" title="User Authorization system" class="">User Authorization system</a>
                          </li>
                          <li class="">
                            <a href="../Developing-Controller-applications/Exception-handling.html" title="Exception handling" class="">Exception handling</a>
                          </li>
                          <li class="">
                            <a href="../Developing-Controller-applications/How-to-use-the-online-help.html" title="How to use the online help" class="">How to use the online help</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../Using-the-PC-SDK/Using-the-PC-SDK-Topic.html" title="Using the PC SDK" class="">Using the PC SDK</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Using-the-PC-SDK/Controller-API.html" title="Controller API" class="">Controller API</a>
                          </li>
                          <li class="">
                            <a href="../Using-the-PC-SDK/Create-a-simple-PC-SDK-application.html" title="Create a simple PC SDK application" class="">Create a simple PC SDK application</a>
                          </li>
                          <li class="">
                            <a href="../Using-the-PC-SDK/Discovery-domain.html" title="Discovery domain" class="">Discovery domain</a>
                          </li>
                          <li class="">
                            <a href="../Using-the-PC-SDK/Accessing-the-controller.html" title="Accessing the controller" class="">Accessing the controller</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../Using-the-PC-SDK/Using-the-PC-SDK-Topic.html" title="Rapid domain" class="">Rapid domain</a>
                              
                              <ul class="nav level3">
                                <li class="">
                                  <a href="../Using-the-PC-SDK/Rapid-domain/Working-with-RAPID-data.html" title="Working with RAPID data" class="">Working with RAPID data</a>
                                </li>
                                <li class="">
                                  <a href="../Using-the-PC-SDK/Rapid-domain/Handling-arrays.html" title="Handling arrays" class="">Handling arrays</a>
                                </li>
                                <li class="">
                                  <a href="../Using-the-PC-SDK/Rapid-domain/ReadItem-and-WriteItem-methods.html" title="ReadItem and WriteItem methods" class="">ReadItem and WriteItem methods</a>
                                </li>
                                <li class="">
                                  <a href="../Using-the-PC-SDK/Rapid-domain/UserDefined-data.html" title="UserDefined data" class="">UserDefined data</a>
                                </li>
                                <li class="">
                                  <a href="../Using-the-PC-SDK/Rapid-domain/RAPID-symbol-search.html" title="RAPID symbol search" class="">RAPID symbol search</a>
                                </li>
                                <li class="">
                                  <a href="../Using-the-PC-SDK/Rapid-domain/Working-with-RAPID-modules-and-programs.html" title="Working with RAPID modules and programs" class="">Working with RAPID modules and programs</a>
                                </li>
                                <li class="">
                                  <a href="../Using-the-PC-SDK/Rapid-domain/Enable-operator-response-to-RAPID-UI-instructions-from-a-PC.html" title="Enable operator response to RAPID UI-instructions from a PC" class="">Enable operator response to RAPID UI-instructions from a PC</a>
                                </li>
                              </ul>  </li>
                          <li class="">
                            <a href="../Using-the-PC-SDK/IO-system-domain.html" title="I/O system domain" class="">I/O system domain</a>
                          </li>
                          <li class="">
                            <a href="../Using-the-PC-SDK/Configuration-domain.html" title="Configuration domain" class="">Configuration domain</a>
                          </li>
                          <li class="">
                            <a href="../Using-the-PC-SDK/Event-log-domain.html" title="Event log domain" class="">Event log domain</a>
                          </li>
                          <li class="">
                            <a href="../Using-the-PC-SDK/Motion-domain.html" title="Motion domain" class="">Motion domain</a>
                          </li>
                          <li class="">
                            <a href="../Using-the-PC-SDK/File-system-domain.html" title="File system domain" class="">File system domain</a>
                          </li>
                          <li class="active">
                            <a href="../Using-the-PC-SDK/Messaging-domain.html" title="Messaging domain" class="active">Messaging domain</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../Debugging-and-troubleshooting/Debugging-and-troubleshooting-Topic.html" title="Debugging and troubleshooting" class="">Debugging and troubleshooting</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Debugging-and-troubleshooting/Debugging.html" title="Debugging" class="">Debugging</a>
                          </li>
                          <li class="">
                            <a href="../Debugging-and-troubleshooting/Troubleshooting.html" title="Troubleshooting" class="">Troubleshooting</a>
                          </li>
                        </ul>  </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../Deployment-of-a-PC-SDK-application/Deployment-of-a-PC-SDK-application-Topic.html" title="Deployment of a PC SDK application" class="">Deployment of a PC SDK application</a>
                        
                        <ul class="nav level2">
                          <li class="">
                            <a href="../Deployment-of-a-PC-SDK-application/Deployment-of-a-PC-SDK-application-overview.html" title="Deployment" class="">Deployment</a>
                          </li>
                        </ul>  </li>
                  </ul>        </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="Messaging-domain">
<h1 id="messaging-domain">Messaging domain</h1>

<h2 id="overview">Overview</h2>
<p>The <code>Messaging</code> domain of the PC SDK can be used to send and receive data between a PC SDK application and a RAPID task.</p>
<p>The corresponding RAPID functionality, <em>RAPID Message Queue</em>, includes RAPID data types and RAPID instructions and
functions for sending and receiving data. It enables communication between RAPID tasks or between a RAPID task and
a PC SDK application.</p>
<p>This section provides information about how to implement messaging in a PC SDK application. To make it work it is
necessary to do part of the implementation in RAPID. In order to show how this can be done, a code example in C# and
RAPID is provided at the end of the section.</p>
<div class="NOTE">
<h5>Note</h5>
<p>For more information on how to implement messaging in RAPID, see
<em>Application manual - Robot communication and I/O Control</em>.</p>
</div>
<h2 id="robotware-option">RobotWare option</h2>
<p>The functionality in RAPID that is needed to utilize messaging - <em>RAPID Message Queue</em> - is included in the
RobotWare options PC Interface, FlexPendant Interface and Multitasking. As <em>PC Interface</em> is required on a robot controller
to be used with a PC SDK client, this means no extra option is needed to start using <em>RAPID Message Queue</em> with
a PC SDK application.</p>
<h2 id="messaging-illustration">Messaging illustration</h2>
<p>The following illustration shows possible senders and receivers in the robot system. The arrows represent ways to
communicate by posting a message to a queue.</p>
<p><img src="../../../images/messaging.jpg" alt=""></p>
<div class="NOTE">
<h5>Note</h5>
<p>In principle, messages might as well be sent between a PC SDK client and a PC SDK application running on the FlexPendant.</p>
</div>
<h2 id="benefits">Benefits</h2>
<p>Together with <em>RAPID Message Queue</em> the functionality of the <code>Messaging</code> domain represent a new, flexible way for a
PC SDK application to interact with a RAPID task.</p>
<p>Messaging is usually done when a RAPID task is executing, but it is also possible to send a message to a RAPID task
when it has been stopped. The RAPID interrupt will then occur once the RAPID task has been started.</p>
<p>A simple example of usage would be to set a flag from a PC SDK application in order to control the program flow
in the RAPID program.</p>
<div class="NOTE">
<h5>Note</h5>
<p>Sending messages can be done in both manual and auto mode. As opposed to using <code>RapidData</code> to modify a
RAPID variable no mastership is required.</p>
</div>
<h2 id="the-messaging-namespace">The Messaging namespace</h2>
<p>The Microsoft Windows operating system provides mechanisms for facilitating communications and data sharing between
applications. Collectively, activities enabled by these mechanisms are called <em>Interprocess communications</em> (IPC).</p>
<p>These are the classes and enumerations available in the <code>Messaging</code> namespace:</p>
<table>
<thead>
<tr>
<th>Classes</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="xref" href="../../../api/ABB.Robotics.Controllers.Controller.html#ABB_Robotics_Controllers_Controller_Ipc">ABB.Robotics.Controllers.Controller.Ipc</a></td>
</tr>
<tr>
<td><a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.IpcMessage.html">ABB.Robotics.Controllers.Messaging.IpcMessage</a></td>
</tr>
<tr>
<td><a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.IpcQueue.html">ABB.Robotics.Controllers.Messaging.IpcQueue</a></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Enumerations</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.IpcReturnType.html">ABB.Robotics.Controllers.Messaging.IpcReturnType</a></td>
</tr>
</tbody>
</table>
<p>The <a class="xref" href="../../../api/ABB.Robotics.Controllers.Controller.html#ABB_Robotics_Controllers_Controller_Ipc">Ipc</a> class is used to handle message
queues with methods like
<a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.Ipc.html#ABB_Robotics_Controllers_Messaging_Ipc_GetQueue_System_String_">GetQueue(String)</a>,
<a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.Ipc.html#ABB_Robotics_Controllers_Messaging_Ipc_CreateQueue_System_String_System_Int32_System_Int32_">CreateQueue(String, Int32, Int32)</a>,
<a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.Ipc.html#ABB_Robotics_Controllers_Messaging_Ipc_DeleteQueue_System_Int32_">DeleteQueue(Int32)</a> and so on. When you have an <code>IpcQueue</code> object you
can use its <a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.IpcQueue.html#ABB_Robotics_Controllers_Messaging_IpcQueue_Send_ABB_Robotics_Controllers_Messaging_IpcMessage_">Send(IpcMessage)</a> method
to send an <code>IpcMessage</code> to a RAPID task or its
<a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.IpcQueue.html#ABB_Robotics_Controllers_Messaging_IpcQueue_Receive_System_Int32_ABB_Robotics_Controllers_Messaging_IpcMessage_">Receive(Int32, IpcMessage)</a>
method to receive a message from a RAPID task.</p>
<p>When sending a message you use an existing queue in the controller as the <code>IpcQueue</code> object.
The naming principle of queues in the controller is using the name of the corresponding task prefixed with
“RMQ_”, e.g “RMQ_T_ROB1”. To receive a message from RAPID you must first create your own message queue and use that
object with the
<a class="xref" href="../../../api/ABB.Robotics.Controllers.Messaging.IpcQueue.html#ABB_Robotics_Controllers_Messaging_IpcQueue_Receive_System_Int32_ABB_Robotics_Controllers_Messaging_IpcMessage_">Receive(Int32, IpcMessage)</a>
method.</p>
<div class="NOTE">
<h5>Note</h5>
<p>When the execution context in a RAPID task is lost, for example when the program pointer is moved to main,
the corresponding queue is emptied.</p>
</div>
<h2 id="basic-approach">Basic approach</h2>
<p>To utilize messaging in a PC SDK application, you need to do the implementation both in RAPID and in the PC application.</p>
<p>To send data from a PC application and receive it in a RAPID task:</p>
<ol>
<li><p>In the PC application connect to the queue of the RAPID task.</p>
</li>
<li><p>Create the message.</p>
</li>
<li><p>Send the message.</p>
</li>
<li><p>In the RAPID program set up a trap routine that reads the message. Connect an interrupt so that the trap routine is
called each time a new message appears.</p>
</li>
</ol>
<p>For a complete code example using this scenario, see <a class="xref" href="Messaging-domain.html#code-example">Code example</a>.</p>
<h2 id="what-can-be-sent-in-a-message">What can be sent in a message?</h2>
<p>In RAPID there is a <code>rmqmessage</code> data type. In the PC SDK the corresponding type is <code>IpcMessage</code>. An <code>IpcMessage</code> object
stores the actual data in the message, but also information about message size, who the sender is and so on.</p>
<p>The data in a message is a pretty-printed string with data type name (and array dimensions) followed by the actual
data value. The data type can be any RAPID data type. Arrays and user defined records are allowed.</p>
<p>Message data - examples:</p>
<p><code>“robtarget;[[930,0,1455],[1,0,0,0],[0,0,0,0],[9E9,9E9,9E9,9E9,9E9,9E9]]”</code></p>
<p><code>“string;“Hello world!””</code></p>
<p><code>“num;23”</code></p>
<p><code>“bool;FALSE”</code></p>
<p><code>“bool{2, 2};[[TRUE,TRUE],[FALSE,FALSE]]”</code></p>
<p><code>“msgrec;[100,200]”</code> (user defined data type)</p>
<p>The method <code>IpcMessage.SetData</code> is used to fill the <code>IpcMessage</code> with the appropriate data. Likewise, the <code>GetData</code> method
retrieves the data from an <code>IpcMessage</code> object.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The <code>IpcMessage.Data</code> is set and retrieved as a byte array, <code>SetData(byte[]data)</code> and <code>byte[] GetData()</code>.
This means you must convert the message data string to a byte array before calling the <code>SetData</code>  method.
It may look like this in C#:</p>
<pre><code class="lang-csharp">Byte[] data = new UTF8Encoding().GetBytes(&quot;string;\&quot;Hello world\&quot;&quot;);
</code></pre>
</div>
<div class="NOTE">
<h5>Note</h5>
<p>The RAPID program can specify what RAPID data type it expects to receive by connecting it to a TRAP routine.
A message containing data of a data type that no interrupt is connected to will be discarded with only an
event log warning.</p>
</div>
<h2 id="rapid-message-queue-system-parameters">RAPID Message Queue system parameters</h2>
<p>This is a brief description of each system parameter of <em>RAPID Message Queue</em>. For further information, see the respective
parameter in <em>Technical reference manual-System parameters</em>.</p>
<p>These parameters belong to the <code>Task</code> type in the <code>Controller</code> topic:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>RmqType</td>
<td>The following values are possible:<br><br><em>None</em> - Disables the RAPID Message Queue functionality in this RAPID task. This is the default value.<br><br><em>Internal</em> - Enables the RAPID Message Queue for local usage on the controller.<br><br><em>Remote</em> - Enables the RAPID Message Queue for local usage and for PC and FlexPendant applications.</td>
</tr>
<tr>
<td>RmqMode</td>
<td><em>Interrupt mode</em> - A message can be received either by connecting a trap routine to a specified message type or by using the sendwait functionality. Any messages that are not the answer to an active send-wait instruction or have the type connected to a trap routine will be discarded. This is the default mode.<br><br><em>Synchronous mode</em> - All messages will be queued and can only be received through the new read-wait instruction RMQReadWait. No messages will be discarded unless the queue is full. The send-wait instruction is not available in this mode.</td>
</tr>
<tr>
<td>RmqMaxMsgSize</td>
<td>The maximum data size, in bytes, for a message. The default value is 350. The value cannot be changed in RobotStudio or on the FlexPendant.</td>
</tr>
<tr>
<td>RmqMaxNoOfMsg</td>
<td>Maximum number of messages in queue. The default value is 5. The value cannot be changed in RobotStudio or on the FlexPendant.</td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>To read the values of these system parameter from the PC SDK you use the <code>IpcQueue</code> properties <code>RemoteAcessible</code>,
<code>MessageSizeLimit</code> and <code>Capacity</code>.</p>
</div>
<h2 id="remote-rmqtype">Remote RmqType</h2>
<p>The system parameter <code>RmqType</code> must be set to <code>Remote</code> to enable messaging between RAPID and PC SDK:</p>
<p><img src="../../../images/remote.jpg" alt=""></p>
<h2 id="code-example">Code example</h2>
<p>This simple messaging example can be tested with a virtual or a real controller. The system parameter <strong>RmqType</strong> must be
set to as shown in <em>RAPIDMessage Queue system parameters</em>.</p>
<p>The following code sample creates a message and sends it to a RAPID task, which reads it and sets a RAPID variable
accordingly. Then an “Acknowledged” message is sent back to the PC SDK queue. Finally, the PC SDK application launches
the received message in a Message Box.</p>
<h3 id="pc-sdk---c">PC SDK - C#</h3>
<p>A message is created and sent to the RAPID queue “RMQ_T_ROB1”. An answer message is then received from RAPID and
launched in a Message Box.</p>
<pre><code class="lang-csharp">//declarations
private Controller c;
private IpcQueue tRob1Queue;
private IpcQueue myQueue;
private IpcMessage sendMessage;
private IpcMessage recMessage;
...
//initiation code, eg in constructor
c = new Controller(); //default ctrl used here (App.config)
//get T_ROB1 queue to send msgs to RAPID task
tRob1Queue = c.Ipc.GetQueue(&quot;RMQ_T_ROB1&quot;);
//create my own PC SDK queue to receive msgs
if (!c.Ipc.Exists(&quot;RAB_Q&quot;))
{
    myQueue = c.Ipc.CreateQueue(&quot;PC_SDK_Q&quot;, 5, Ipc.IPC_MAXMSGSIZE);
    myQueue = c.Ipc.GetQueue(&quot;PC_SDK_Q&quot;);
}
//Create IpcMessage objects for sending and receiving
sendMessage = new IpcMessage();
recMessage = new IpcMessage();
...
//in an event handler, eg. button_Click
SendMessage(true);
CheckReturnMsg();
...
public void SendMessage(bool boolMsg)
{
    Byte[] data = null;
    //Create message data
    if (boolMsg)
    {
        data = new UTF8Encoding().GetBytes(&quot;bool;TRUE&quot;);
    }
    else
    {
        data = new UTF8Encoding().GetBytes(&quot;bool;FALSE&quot;);
    }
    //Place data and sender information in message
    sendMessage.SetData(data);
    sendMessage.Sender = myQueue.QueueId;
    //Send message to the RAPID queue
    tRob1Queue.Send(sendMessage);
}

private void CheckReturnMsg()
{
    IpcReturnType ret = IpcReturnType.Timeout;
    string answer = string.Empty;
    int timeout = 5000;
    //Check for msg in the PC SDK queue
    ret = myQueue.Receive(timeout, recMessage);
    if (ret == IpcReturnType.OK)
    {
        //convert msg data to string
        answer = new UTF8Encoding().GetString(recMessage.Data);
        MessageBox.Show(answer);
        //MessageBox should show: string;&quot;Acknowledged&quot;
    }
    else
    {
        MessageBox.Show(&quot;Timeout!&quot;);
    }
}
</code></pre>
<h3 id="rapid">RAPID</h3>
<p>A trap is created for a message of data type <code>bool</code>. In the trap, the value of the message data is assigned to the
variable. Then an <em>Acknowledged</em> message is sent back to the PC SDK client. In <em>main</em> the WHILE loop is executed until
a message with a TRUE value is received.</p>
<pre><code class="lang-plaintext">MODULE RAB_COMMUNICATION
    VAR bool flag := FALSE;
    VAR intnum connectnum;
    PROC main()
        CONNECT connectnum WITH RABMsgs;
        IRMQMessage flag, connectnum;
        WHILE flag = FALSE DO
            !do something, eg. normal processing...
            WaitTime 3;
        ENDWHILE
        !PC SDK message received - do something...
        TPWrite &quot;Message from PC SDK, will now...&quot;;
        IDelete connectnum;
        EXIT;
    ENDPROC
    TRAP RABMsgs
        VAR rmqmessage msg;
        VAR rmqheader header;
        VAR rmqslot rabclient;
        VAR num userdef;
        VAR string ack := &quot;Acknowledged&quot;;
        RMQGetMessage msg;
        RMQGetMsgHeader msg \Header:=header
            \SenderId:=rabclient\UserDef:=userdef;
        !check data type and assign value to flag variable
        IF header.datatype = &quot;bool&quot; THEN
            RMQGetMsgData msg, flag;
            !return receipt to sender
            RMQSendMessage rabclient, ack;
        ELSE
            TPWrite &quot;Unknown data received in RABMsgs...&quot;;
        ENDIF
    ENDTRAP
ENDMODULE
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>Error handling should be implemented in C# and in RAPID.</p>
</div>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © 2024 ABB</span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
